<!--pages/search/search.wxml-->
<view class="page-container">
  <!-- 顶部搜索栏 -->
  <view class="search-header" style="padding-top: {{statusBarHeight}}px;">
    <view class="search-bar">
      <view class="back-btn" bindtap="onBack">
        <t-icon name="chevron-left" size="48rpx" color="#1a1a1a" />
      </view>
      <view class="search-input-wrap">
        <t-icon name="search" size="36rpx" color="#9CA3AF" />
        <input 
          class="search-input" 
          placeholder="搜索课程、线路、基地..." 
          placeholder-class="search-placeholder"
          value="{{keyword}}"
          focus="{{true}}"
          bindinput="onInput"
          bindconfirm="onSearchConfirm"
          confirm-type="search"
        />
        <view wx:if="{{keyword}}" class="clear-btn" bindtap="onClear">
          <t-icon name="close-circle-filled" size="32rpx" color="#9CA3AF" />
        </view>
      </view>
      <view class="search-btn" bindtap="onSearchConfirm">
        <text>搜索</text>
      </view>
    </view>

    <!-- 搜索类型 -->
    <view class="type-bar">
      <view 
        wx:for="{{searchTypes}}" 
        wx:key="id"
        class="type-item {{currentType === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onTypeChange"
      >
        <text>{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 占位高度 -->
  <view style="height: {{statusBarHeight + 140}}px;"></view>

  <!-- 搜索前：热门搜索 + 历史记录 -->
  <view class="search-suggest" wx:if="{{!showResult}}">
    <!-- 热门搜索 -->
    <view class="suggest-section">
      <text class="suggest-title font-serif">热门搜索</text>
      <view class="keyword-list">
        <view 
          wx:for="{{hotKeywords}}" 
          wx:key="*this"
          class="keyword-tag"
          data-keyword="{{item}}"
          bindtap="onKeywordTap"
        >
          <text>{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 搜索历史 -->
    <view class="suggest-section" wx:if="{{historyKeywords.length > 0}}">
      <view class="suggest-header">
        <text class="suggest-title font-serif">搜索历史</text>
        <view class="clear-history" bindtap="onClearHistory">
          <t-icon name="delete" size="32rpx" color="#9CA3AF" />
        </view>
      </view>
      <view class="keyword-list">
        <view 
          wx:for="{{historyKeywords}}" 
          wx:key="*this"
          class="keyword-tag keyword-tag--history"
          data-keyword="{{item}}"
          bindtap="onKeywordTap"
        >
          <text>{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 搜索结果 -->
  <view class="search-result" wx:if="{{showResult && !loading}}">
    <!-- 课程结果 -->
    <view class="result-section" wx:if="{{(currentType === 'all' || currentType === 'course') && courseResults.length > 0}}">
      <text class="result-title font-serif">课程 ({{courseResults.length}})</text>
      <view class="result-list">
        <view 
          wx:for="{{courseResults}}" 
          wx:key="id"
          class="result-item"
          data-id="{{item.id}}"
          bindtap="onCourseTap"
        >
          <course-card course="{{item}}" mode="horizontal" />
        </view>
      </view>
    </view>

    <!-- 线路结果 -->
    <view class="result-section" wx:if="{{(currentType === 'all' || currentType === 'route') && routeResults.length > 0}}">
      <text class="result-title font-serif">线路 ({{routeResults.length}})</text>
      <view class="result-list">
        <view 
          wx:for="{{routeResults}}" 
          wx:key="id"
          class="result-item"
          data-id="{{item.id}}"
          bindtap="onRouteTap"
        >
          <route-card route="{{item}}" mode="horizontal" />
        </view>
      </view>
    </view>

    <!-- 基地结果 -->
    <view class="result-section" wx:if="{{(currentType === 'all' || currentType === 'base') && baseResults.length > 0}}">
      <text class="result-title font-serif">基地 ({{baseResults.length}})</text>
      <view class="result-list">
        <view 
          wx:for="{{baseResults}}" 
          wx:key="id"
          class="result-item"
          data-id="{{item.id}}"
          bindtap="onBaseTap"
        >
          <base-card base="{{item}}" mode="list" />
        </view>
      </view>
    </view>

    <!-- 无结果 -->
    <empty-state 
      wx:if="{{courseResults.length === 0 && routeResults.length === 0 && baseResults.length === 0}}"
      type="search"
      title="未找到相关内容"
      description="换个关键词试试"
    />
  </view>

  <!-- 加载中 -->
  <view wx:if="{{loading}}" class="loading-wrap">
    <t-icon name="loading" size="48rpx" color="#C8102E" class="loading-icon" />
    <text class="loading-text">搜索中...</text>
  </view>
</view>
