<!--pages/base-detail/base-detail.wxml-->
<view class="page-container">
  <!-- 顶部固定区域：标题 -->
  <view class="header" style="padding-top: {{statusBarHeight}}px;">
    <view class="header-content">
      <view class="back-button" bindtap="onBackTap">
        <t-icon name="chevron-left" size="52rpx" color="#1a1a1a" />
      </view>
      <!-- 标题栏 -->
      <view class="title-bar">
        <text class="app-title">基地详情</text>
      </view>
    </view>
  </view>

  <view style="height: {{statusBarHeight + 108}}rpx;"></view> <!-- Placeholder for fixed header -->

  <block wx:if="{{base}}">
    <!-- 封面图轮播 -->
    <view class="cover-section">
      <swiper 
        class="cover-swiper"
        indicator-dots="{{false}}"
        autoplay="{{true}}"
        interval="{{4000}}"
        duration="{{500}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{imageList}}" wx:key="*this">
          <image class="cover-image" src="{{item}}" mode="aspectFill" />
        </swiper-item>
      </swiper>
      <!-- 自定义指示器 -->
      <view class="swiper-indicator" wx:if="{{imageList.length > 1}}">
        <text class="indicator-text">{{currentImageIndex + 1}}/{{imageList.length}}</text>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="info-section">
      <text class="base-title">{{base.name}}</text>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">机构类型:</text>
          <text class="info-value">{{base.type}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">所属区域:</text>
          <text class="info-value">{{base.district}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">基地等级:</text>
          <text class="info-value link">{{base.levelName}}</text>
        </view>
      </view>
    </view>

    <!-- 地址与导航卡片 -->
    <view class="location-card" bindtap="onNavigateTap">
      <view class="location-info">
        <view class="location-icon-box">
          <t-icon name="location" size="40rpx" color="var(--td-brand-color)" />
        </view>
        <view class="location-detail">
          <text class="location-title">地址信息</text>
          <text class="location-address">{{base.address}}</text>
        </view>
      </view>
      <view class="location-actions">
         <t-icon name="navigation" size="40rpx" color="#999" />
      </view>
    </view>

    <!-- 分隔条 -->
    <view class="divider" />

    <!-- Tab切换 -->
    <view class="tab-bar" style="top: {{statusBarHeight + 108}}rpx;">
      <view 
        wx:for="{{tabs}}" 
        wx:key="id"
        class="tab-item {{currentTab === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onTabChange"
      >
        <text class="tab-text">{{item.name}}</text>
        <view wx:if="{{currentTab === item.id}}" class="tab-indicator" />
      </view>
    </view>

    <!-- Tab内容区域 -->
    <view class="tab-content">
      <!-- 基地详情 -->
      <view wx:if="{{currentTab === 'detail'}}" class="detail-content">
        <expandable-text 
          content="{{base.description}}" 
          maxLines="{{6}}"
        />
      </view>

      <!-- 相关课程 -->
      <view wx:if="{{currentTab === 'courses'}}" class="courses-content">
        <view wx:if="{{relatedCourses.length > 0}}" class="course-list">
          <view 
            wx:for="{{relatedCourses}}" 
            wx:key="id"
            class="course-item"
            bindtap="onCourseTap"
            data-id="{{item.id}}"
          >
            <view class="course-cover">
              <image class="course-image" src="{{item.imageUrl}}" mode="aspectFill" />
            </view>
            <view class="course-info">
              <text class="course-title">{{item.title}}</text>
              <view class="course-tags">
                <text class="tag">{{item.gradeLevel}}</text>
                <text class="tag">{{item.duration}}</text>
              </view>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">暂无相关课程</view>
      </view>
    </view>

    <view class="safe-bottom" />
  </block>
</view>
