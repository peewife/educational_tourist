<!--pages/route-detail/route-detail.wxml-->
<view class="page-container">
  <!-- 顶部固定区域：标题 -->
  <view class="header" style="padding-top: {{statusBarHeight}}px;">
    <view class="header-content">
      <view class="back-button" bindtap="onBackTap">
        <t-icon name="chevron-left" size="52rpx" color="#1a1a1a" />
      </view>
      <!-- 标题栏 -->
      <view class="title-bar">
        <text class="app-title">线路详情</text>
      </view>
    </view>
  </view>

  <view style="height: {{statusBarHeight + 108}}rpx;"></view> <!-- Placeholder for fixed header -->

  <block wx:if="{{route}}">
    <!-- 封面图轮播 -->
    <view class="cover-section">
      <swiper 
        class="cover-swiper"
        indicator-dots="{{false}}"
        autoplay="{{true}}"
        interval="{{4000}}"
        duration="{{500}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{imageList}}" wx:key="*this">
          <image class="cover-image" src="{{item}}" mode="aspectFill" />
        </swiper-item>
      </swiper>
      <!-- 自定义指示器 -->
      <view class="swiper-indicator" wx:if="{{imageList.length > 1}}">
        <text class="indicator-text">{{currentImageIndex + 1}}/{{imageList.length}}</text>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="info-section">
      <text class="route-title">{{route.title}}</text>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">适用学段:</text>
          <view class="info-values">
            <text 
              wx:for="{{route.gradeLevel}}" 
              wx:key="*this"
              class="info-value"
            >{{item}}</text>
          </view>
        </view>
        <view class="info-item">
          <text class="info-label">行程天数:</text>
          <text class="info-value">{{route.duration}}</text>
        </view>
        <view class="info-item" wx:if="{{route.baseNames && route.baseNames.length > 0}}">
          <text class="info-label">相关基地:</text>
          <view class="info-values column">
            <text 
              wx:for="{{route.baseNames}}" 
              wx:for-index="idx"
              wx:key="*this"
              class="info-value link"
              data-id="{{route.baseIds[idx]}}"
              bindtap="onBaseTap"
            >{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 机构信息卡片 -->
    <view class="agency-card" wx:if="{{agency}}" bindtap="onAgencyTap">
      <view class="agency-info">
        <view class="agency-logo">
          <text class="logo-text">{{agency.logoText}}</text>
        </view>
        <view class="agency-detail">
          <text class="agency-name">{{agency.name}}</text>
          <text class="agency-address">{{agency.address}}</text>
        </view>
      </view>
      <view class="agency-actions">
        <t-icon name="location" size="40rpx" color="#999" catchtap="onNavigationTap" />
        <t-icon name="call" size="40rpx" color="#999" catchtap="onPhoneTap" />
      </view>
    </view>

    <!-- 分隔条 -->
    <view class="divider" />

    <!-- Tab切换 -->
    <view class="tab-bar" style="top: {{statusBarHeight + 108}}rpx;">
      <view 
        wx:for="{{tabs}}" 
        wx:key="id"
        class="tab-item {{currentTab === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onTabChange"
      >
        <text class="tab-text">{{item.name}}</text>
        <view wx:if="{{currentTab === item.id}}" class="tab-indicator" />
      </view>
    </view>

    <!-- Tab内容 -->
    <view class="tab-content">
      <!-- 线路详情 -->
      <view wx:if="{{currentTab === 'detail'}}" class="detail-content">
        <expandable-text 
          content="{{route.description}}" 
          maxLines="{{6}}"
        />
      </view>

      <!-- 线路安排 -->
      <view wx:if="{{currentTab === 'schedule'}}" class="schedule-content">
        <timeline 
          wx:if="{{route.schedule && route.schedule.length > 0}}"
          items="{{route.schedule}}" 
          theme="blue"
        />
        <view wx:else class="empty-tip">暂无行程安排</view>
      </view>

      <!-- 费用明细 -->
      <view wx:if="{{currentTab === 'fees'}}" class="fees-content">
        <view class="price-row">
          <text class="price-label">研学费用:</text>
          <text class="price-value orange">{{route.price}}</text>
          <text class="price-unit">元/人(参考价)</text>
        </view>
        <text class="fee-desc">{{route.feeDescription || '费用包含：交通、餐饮、住宿、门票、保险、导师费等。'}}</text>
      </view>
    </view>

    <view class="safe-bottom" />
  </block>

  <!-- 底部操作栏 -->
  <bottom-action-bar 
    wx:if="{{route}}"
    price="{{route.price}}"
    priceUnit="元/人"
    priceLabel="参考价"
    buttonText="立即报名"
    buttonTheme="orange"
    secondaryButtonText="电话咨询"
    showSecondaryButton="{{true}}"
    bind:secondary="onPhoneTap"
    bind:submit="onEnrollTap"
  />
</view>
